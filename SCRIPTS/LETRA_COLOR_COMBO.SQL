SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		MABEL MOLINA
-- Create date: 30-JUN-2011
-- Description:	DEVUELVE COLORES DE COMBINACION
-- =============================================
ALTER PROCEDURE LETRA_COLOR_COMBO
	-- Add the parameters for the stored procedure here
	@COL VARCHAR(10),
	@COM CHAR(2)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	SELECT COLOR, DESCRIPCION, SEC, ALTURA, RAPPORT, NUMCOL, NUMFRA, PASADAS,
		LETRA1, D1 = (SELECT descripcion FROM RAYACOLOR RC1 INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO	
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA1 = RC1.LETRA ),
		C1 = (SELECT CODIGO FROM RAYACOLOR RC1 INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA1 = RC1.LETRA ),
		letra2, D2 = (SELECT descripcion FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA2 = RC1.LETRA ),
		C2 = (SELECT CODIGO FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA2 = RC1.LETRA ),
		letra3, D3 = (SELECT descripcion FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA3 = RC1.LETRA ),
		C3 = (SELECT CODIGO FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA3 = RC1.LETRA ),
		letra4, D4 = (SELECT descripcion FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA4 = RC1.LETRA ),
		C4 = (SELECT CODIGO FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA4 = RC1.LETRA ),
		letra5, D5 = (SELECT descripcion FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA5 = RC1.LETRA ),
		C5 = (SELECT CODIGO FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA5 = RC1.LETRA ),
		letra6, D6 = (SELECT descripcion FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA6 = RC1.LETRA ),
		C6 = (SELECT CODIGO FROM RAYACOLOR RC1	INNER JOIN COLORES C1 ON RC1.CODCOL = C1.CODIGO
		WHERE RC1.COMBIN = @COM AND RC1.COLOR = @COL AND R1.LETRA6 = RC1.LETRA ),
		FIBRA1,  fibra2, fibra3, fibra4, fibra5, fibra6
		FROM RAYASEC AS R1 
		RIGHT OUTER JOIN COLORES ON COLOR = CODIGO 
		WHERE COMBIN = '00' AND COLOR = @COL AND R1.ESTADO = 'A' 
		group by COLOR, DESCRIPCION, LETRA1, SEC, ALTURA, RAPPORT, NUMCOL, 
				NUMFRA, PASADAS, FIBRA1, letra2, letra3, letra4,letra5,letra6, 
				fibra2, fibra3, fibra4, fibra5, fibra6 
		ORDER BY 3 


END
GO
